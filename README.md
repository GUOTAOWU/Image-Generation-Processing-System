# 画像生成および処理システム (Image Generation and Processing System)

## 1. プロジェクト紹介 (Project Introduction)
本プロジェクトは、視覚コンテンツの生成、編集、および理解を一体化したWebベースの画像処理システムです 。テキストからの画像生成（文生図）、画像の切り抜き（背景除去）、テキスト認識（OCR）、および画像の編集（トリミング・解像度変更）機能を単一のプラットフォームに統合しています 。
ユーザーは直感的なWebインターフェースを通じて、アカウント登録・ログインから画像のアップロード、AIモデルによる処理、そして結果のダウンロードまでをシームレスに行うことができます 。

主な機能:
* **テキスト画像生成 (Text-to-Image):** DashScope (通義万相) を利用し、テキストプロンプトから高品質な画像を生成 。
* **画像切り抜き (Matting):** MODNetを使用し、Trimap不要で人物の前景を高精度に分離 。
* **文字認識 (OCR):** EasyOCRを統合し、画像内の多言語テキストを自動抽出 。
* **画像編集:** クロップ（切り取り）や解像度の変更機能を提供 。

## 2. ファイル・モジュール構成 (File & Module Description)
本システムはモジュール化された設計を採用しており、主要な機能は以下のように構成されています。

* **認証モジュール (User Authentication):**
    * ユーザーの登録およびログイン機能を処理します。SQLiteデータベースを使用してユーザー情報を管理し、セキュアなアクセスを提供します 。
* **メインダッシュボード (Main Dashboard):**
    * ログイン後のナビゲーションハブです。サイドバーから各機能（OCR, 切り抜き, 文生図など）へアクセスできます 。
* **OCRモジュール (Text Extraction):**
    * 画像のアップロードを受け付け、EasyOCRを用いてテキスト検出と認識を行い、結果をテキストとバウンディングボックス付き画像で表示します 。
* **Mattingモジュール (Image Matting):**
    * 人物画像から背景を自動的に除去し、透明背景（Alphaチャンネル）を持つPNGとして出力・ダウンロード機能を提供します 。
* **画像生成モジュール (Text-to-Image Generation):**
    * ユーザーが入力したプロンプトと設定（サイズ、枚数）に基づき、DashScope APIを呼び出して画像を生成します 。
* **編集ツール (Editing Tools):**
    * 画像のトリミング（Crop）や解像度変更（Resize）を行うためのユーティリティです 。

## 3. データセット (Dataset)
本プロジェクトは推論（Inference）を中心としたアプリケーションであり、モデルの学習自体は行っていませんが、使用しているモデルは以下のデータセット等で事前学習されています。

* **MODNet (Matting):** Adobe Matting Dataset や PPM-100 データセットなどで学習され、Trimapなしでの高い汎化性能を持っています 。
* **EasyOCR:** 多言語データセットで学習されており、80以上の言語に対応しています 。
* **DashScope (Wanxiang):** 大規模な画像-テキストペアデータセットを用いて学習された基盤モデルを使用しています 。

※ システム内では、ユーザーがアップロードした画像および生成された画像が処理対象データとなります 。

## 4. 使用手法・アルゴリズム (Methods & Algorithms)
本システムでは、以下の先端技術・モデルを組み合わせて実装しています 。

* **DashScope ImageSynthesis (通義万相):**
    * アリババクラウドが提供するMaaS (Model-as-a-Service) です。拡散モデル（Diffusion Models）技術に基づき、テキストの意味理解と画像の生成を行います 。
* **MODNet (Matting Objective Decomposition Network):**
    * 軽量かつリアルタイムな人物切り抜きモデルです。「意味推定」「詳細予測」「意味-詳細融合」の3つのブランチ構造を持ち、e-ASPPモジュールとSOC（自己教師あり一貫性）戦略により、RGB画像のみから高精度なAlpha Matteを生成します 。
* **EasyOCR:**
    * ディープラーニングに基づくOCRライブラリです。CRAFTアルゴリズムによるテキスト検出と、ResNet + LSTM + CTCを用いたテキスト認識を組み合わせています 。

## 5. 実施内容・実装詳細 (Implementation Details)
システムは以下の環境と技術スタックで開発・実装されました 。

### 開発環境
* **OS:** Windows 11 
* **言語:** Python 3.9 
* **フレームワーク:**
    * **FastAPI:** バックエンド処理およびAPI提供 。
    * **Streamlit:** フロントエンドのUI構築および対話処理 。
* **データベース:** SQLite 
* **ツール:** PyCharm, Edge 

### 処理フロー
1.  **環境構築:** Python環境に `easyocr`, `modnet`, `dashscope` などの依存ライブラリを統合 。
2.  **UI構築:** Streamlitを用いて、ログイン画面、メインメニュー、各機能ページを設計。サイドバーによるナビゲーションを実装 。
3.  **機能統合:**
    * **OCR:** アップロード画像を前処理し、EasyOCRリーダーで推論を実行。結果をオーバーレイ表示 。
    * **Matting:** 画像をリサイズ・正規化してMODNetに入力し、Alpha Matteを推定して元画像と合成 。
    * **生成:** DashScope SDKを通じてプロンプトを送信し、返却された画像URLを表示・保存 。
4.  **最適化:** 推論パイプラインの安定化、後処理（透明背景化など）の実装、およびAPIキー管理などのセキュリティ対策を実施。

## 6. 結論 (Conclusion)
本プロジェクトにより、以下の成果が得られました。

1.  **統合システムの実現:** 文生図、切り抜き、OCRという異なるAIタスクを単一のWebプラットフォームに統合し、ユーザー認証から画像出力までの完全なワークフローを確立しました 。
2.  **実用性と効率:** 統一されたインターフェースにより、ユーザーの操作手順を大幅に簡素化しました。また、MODNetやDashScopeの活用により、高い生成品質とリアルタイム性を両立しました 。
3.  **拡張性:** モジュール化された設計により、将来的な機能追加やモデルの置き換えが容易な構造となっています 。

今後の課題として、クラウド依存（DashScope）に対するローカルフォールバックの実装や、モジュール間（OCR結果を生成プロンプトに利用するなど）の連携強化が挙げられます 。

